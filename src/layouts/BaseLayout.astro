---
import '../styles/main.css';
import LanguageSwitcher from '../components/LanguageSwitcher.astro';
import type { BaseLayoutProps } from '../types/layout';

type Props = BaseLayoutProps;

const { title, description, lang, navBrand, navLinks, footerCopyright, footerLinks, footerSocial, themeToggleLabel } = Astro.props;
---

<!DOCTYPE html>
<html lang={lang} transition:animate="fade">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>{title}</title>
		<meta name="description" content={description} />
		<script is:inline>
			// Theme Preservation for View Transitions - must run inline to prevent FOUC
			document.addEventListener('astro:before-swap', (e) => {
				const currentTheme = document.documentElement.getAttribute('data-theme');
				if (currentTheme) {
					localStorage.setItem('theme', currentTheme);
				}
				const theme = localStorage.getItem('theme') || 'light';
				e.newDocument.documentElement.setAttribute('data-theme', theme);
			});

			// Apply theme immediately on first load
			(function() {
				const theme = localStorage.getItem('theme') || 'light';
				document.documentElement.setAttribute('data-theme', theme);
			})();
		</script>
	</head>
	<body>
		<!-- Navigation -->
		<nav class="navbar">
			<div class="container">
				<div class="nav-content">
					<div class="logo">
						<img src="/favicon.svg" alt="Logo" style="width: 24px; height: 24px; margin-right: 0.5rem;">
						{navBrand}
					</div>
					<ul class="nav-menu">
						<li><a href="#services">{navLinks.services}</a></li>
						<li><a href="#about">{navLinks.about}</a></li>
						<li><a href="#contact">{navLinks.contact}</a></li>
					</ul>
					<div style="display: flex; gap: 1rem; align-items: center;">
						<LanguageSwitcher />
						<button id="theme-toggle" class="theme-toggle" aria-label={themeToggleLabel}>
							<svg class="sun-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
								<circle cx="12" cy="12" r="5" fill="#FDB813"/>
								<g fill="#FDB813">
									<circle cx="12" cy="3" r="1.5"/>
									<circle cx="12" cy="21" r="1.5"/>
									<circle cx="3" cy="12" r="1.5"/>
									<circle cx="21" cy="12" r="1.5"/>
									<circle cx="5.64" cy="5.64" r="1.5"/>
									<circle cx="18.36" cy="18.36" r="1.5"/>
									<circle cx="5.64" cy="18.36" r="1.5"/>
									<circle cx="18.36" cy="5.64" r="1.5"/>
								</g>
							</svg>
							<svg class="moon-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
								<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" fill="#FFC107"/>
							</svg>
						</button>
					</div>
				</div>
			</div>
		</nav>

		<!-- Main Content -->
		<slot />

		<!-- Footer -->
		<footer class="footer">
			<div class="container">
				<div class="footer-content">
					{footerLinks && (
						<div class="footer-links">
							<a href="/">{footerLinks.home}</a>
							<a href="#services">{footerLinks.services}</a>
							<a href="#about">{footerLinks.about}</a>
							<a href="#contact">{footerLinks.contact}</a>
							<a href="#">{footerLinks.resume}</a>
						</div>
					)}
					
					{footerSocial && (
						<div class="footer-social">
							<a href="#" aria-label={footerSocial.linkedin}>{footerSocial.linkedin}</a>
							<a href="#" aria-label={footerSocial.github}>{footerSocial.github}</a>
							<a href="https://wa.me/" aria-label={footerSocial.whatsapp}>{footerSocial.whatsapp}</a>
						</div>
					)}
					
					<p class="footer-copyright">{footerCopyright}</p>
				</div>
			</div>
		</footer>

		<script is:inline>
			// Initialize theme toggle
			function setupThemeToggle() {
				const themeToggle = document.getElementById('theme-toggle');
				const html = document.documentElement;
				
				if (!themeToggle) return;
				
				// Remove old listener by cloning
				const newButton = themeToggle.cloneNode(true);
				themeToggle.parentNode.replaceChild(newButton, themeToggle);
				
				// Add click listener
				newButton.addEventListener('click', function(e) {
					e.preventDefault();
					e.stopPropagation();
					
					const theme = html.getAttribute('data-theme');
					const newTheme = theme === 'light' ? 'dark' : 'light';
					
					html.setAttribute('data-theme', newTheme);
					localStorage.setItem('theme', newTheme);
				});
			}

			// Run on DOM ready
			if (document.readyState === 'loading') {
				document.addEventListener('DOMContentLoaded', setupThemeToggle);
			} else {
				setupThemeToggle();
			}

			// Re-run after view transitions complete
			document.addEventListener('astro:after-swap', setupThemeToggle);
		</script>

		<script>
			// Initialize page functionality
			function initializePage() {
				// Smooth scrolling for anchor links
				document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
					anchor.addEventListener('click', function (e) {
						e.preventDefault();
						const href = (e.currentTarget as HTMLAnchorElement).getAttribute('href');
						const target = href ? document.querySelector(href) : null;
						if (target) {
							target.scrollIntoView({
								behavior: 'smooth',
								block: 'start'
							});
						}
					});
				});

				// Form submission handling
				const contactForm = document.querySelector('.contact-form') as HTMLFormElement | null;
				
				contactForm?.addEventListener('submit', (e) => {
					e.preventDefault();
					const successMessage = contactForm.getAttribute('data-success-message') || 'Thanks for reaching out!';
					alert(successMessage);
					contactForm.reset();
				});
			}

			// Run on initial page load
			initializePage();

			// Re-run after view transitions
			document.addEventListener('astro:page-load', initializePage);
		</script>
	</body>
</html>
